<!DOCTYPE html>
<html lang="de">
<head>
<link rel="icon" type="image/png" href="icon-512.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline Document Viewer</title>
<style>
body { font-family: sans-serif; padding: 20px; background-color: #0b0d12; color: #fff; }
button { margin: 5px; padding: 10px 15px; font-size: 1rem; background-color: #1f222d; color: #fff; border: 1px solid #444; border-radius: 5px; cursor: pointer; }
button:hover { background-color: #2a2e3c; }
#viewer { margin-top: 20px; border: 1px solid #444; padding: 10px; overflow-x:auto; background-color: #1c1f28; color: #fff; min-height: 200px; }
canvas { max-width: 100%; height: auto; display: block; margin: 0 auto; }

.slide { 
    border: 1px solid #555; 
    margin: 10px auto; 
    padding: 20px; 
    background: #1c1f28; 
    width: 90%; 
    max-width: 600px; 
    min-height: 300px; 
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    display: none;
    color: #fff;
}
.slide p { margin: 5px 0; font-size: 1rem; }

.nav-buttons { text-align: center; margin-top: 10px; }
.nav-buttons button { padding: 10px 20px; font-size: 1rem; }
</style>
</head>
<body>
<h2>Offline Document Viewer</h2>

<input type="file" id="pdfFile" accept=".pdf" style="display:none"/>
<button onclick="document.getElementById('pdfFile').click()">PDF öffnen</button>

<input type="file" id="docxFile" accept=".docx" style="display:none"/>
<button onclick="document.getElementById('docxFile').click()">Word öffnen</button>

<input type="file" id="xlsxFile" accept=".xlsx" style="display:none"/>
<button onclick="document.getElementById('xlsxFile').click()">Excel öffnen</button>

<input type="file" id="pptxFile" accept=".pptx" style="display:none"/>
<button onclick="document.getElementById('pptxFile').click()">PowerPoint öffnen</button>

<input type="file" id="odfFile" accept=".odt,.ods,.odp" style="display:none"/>
<button onclick="document.getElementById('odfFile').click()">ODF öffnen</button>

<div id="viewer">Bitte eine Datei hochladen...</div>
<div class="nav-buttons" id="pptNav" style="display:none;">
    <button id="prevSlide">← Zurück</button>
    <button id="nextSlide">Weiter →</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.12.313/pdf.min.js"></script>
<script src="https://unpkg.com/docx-preview@1.0.1/dist/docx-preview.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://webodf.org/webodf.js"></script>

<script>
const viewer = document.getElementById('viewer');
const pptNav = document.getElementById('pptNav');
let slides = [];
let currentSlide = 0;

function showSlide(index) {
    if(slides.length === 0) return;
    slides.forEach((s,i)=> s.style.display = i===index ? 'block' : 'none');
}

// PDF
document.getElementById('pdfFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    if(!file) return;
    const data = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({data}).promise;
    const page = await pdf.getPage(1);
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const viewport = page.getViewport({scale: 1.5});
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    await page.render({canvasContext: ctx, viewport}).promise;
    viewer.innerHTML = '';
    viewer.appendChild(canvas);
    pptNav.style.display = 'none';
});

// DOCX
document.getElementById('docxFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    if(!file) return;
    const buffer = await file.arrayBuffer();
    const docx = new DocxPreview(buffer);
    viewer.innerHTML = '';
    docx.render(viewer);
    pptNav.style.display = 'none';
});

// XLSX
document.getElementById('xlsxFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    if(!file) return;
    const buffer = await file.arrayBuffer();
    const workbook = XLSX.read(buffer, {type:"array"});
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    viewer.innerHTML = XLSX.utils.sheet_to_html(sheet);
    pptNav.style.display = 'none';
});

// PPTX
document.getElementById('pptxFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    if(!file) return;
    const buffer = await file.arrayBuffer();
    const zip = await JSZip.loadAsync(buffer);
    viewer.innerHTML = '';
    slides = [];

    const slideFiles = Object.keys(zip.files).filter(f => f.startsWith('ppt/slides/slide') && f.endsWith('.xml'));
    if(slideFiles.length === 0){
        viewer.innerHTML = "<p>Keine Folien gefunden oder PPTX nicht kompatibel.</p>";
        pptNav.style.display = 'none';
        return;
    }

    for (let slideFile of slideFiles) {
        try {
            const slideData = await zip.files[slideFile].async('text');
            const texts = [...slideData.matchAll(/<a:t>(.*?)<\/a:t>/g)].map(m=>m[1]);
            const div = document.createElement('div');
            div.className = 'slide';
            div.innerHTML = texts.length>0 ? texts.map(t=>`<p>${t}</p>`).join('') : '<p>(leere Folie)</p>';
            viewer.appendChild(div);
            slides.push(div);
        } catch(err){
            console.error('Fehler beim Lesen der Folie', err);
        }
    }

    currentSlide=0;
    showSlide(currentSlide);
    pptNav.style.display = 'block';
});

document.getElementById('prevSlide').addEventListener('click', ()=>{ if(currentSlide>0) currentSlide--; showSlide(currentSlide); });
document.getElementById('nextSlide').addEventListener('click', ()=>{ if(currentSlide<slides.length-1) currentSlide++; showSlide(currentSlide); });

// ODF
document.getElementById('odfFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        viewer.innerHTML = '';
        const odfCanvas = new odf.OdfCanvas(viewer);
        odfCanvas.load(reader.result);
        pptNav.style.display = 'none';
    };
    reader.readAsArrayBuffer(file);
});
</script>
</body>
</html>
